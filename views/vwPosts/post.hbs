{{#section 'title'}}Viết bài - {{/section}}
{{#section 'js'}}
<script src="https://cdn.tiny.cloud/1/nqsoj71qx22t3rxse0ny3k123bidvew4f6awk5ruf30k8xny/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>


{{/section}}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin/posts/cat/{{this.category.CID}}">Chuyên mục {{this.category.CName}}</a></li>
        <li class="breadcrumb-item active" aria-current="page">Viết bài</li>
    </ol>
</nav>

<div class="card">
    <div class="card-body">
        <form method="post">
            <div class="form-group">
                <label for="txtPostTitle">Tiêu đề</label>
                <input type="text" id="txtPostTitle" name="PostTitle" class="form-control">
            </div>

            <!-- Dropdown chọn chuyên mục lớn -->
            <form method="post">
    <div class="form-group">
        <label for="txtCID">Chọn chuyên mục lớn</label>
        <select class="form-control" id="txtCID" name="CID" onchange="loadSubcategories(this.value)">
            <option value="">Chọn chuyên mục lớn</option>
            {{#each category}}
                <option value="{{CID}}">{{CName}}</option>
            {{/each}}
        </select>
    </div>

    <!-- Dropdown chọn chuyên mục con -->
    <div class="form-group">
        <label for="txtSCID">Chọn chuyên mục con</label>
        <select class="form-control" id="txtSCID" name="SCID">
            <option value="">Chọn chuyên mục con</option>
            {{#each category}}
                {{#each Subcategory}}
                    <option value="{{SCID}}">{{SCName}}</option>
                {{/each}}
            {{/each}}
        </select>   
    </div>

            <div class="form-group">
                <label for="txtSumContent">Nội dung tóm tắt</label>
                <input type="text" id="txtSumContent" name="SumContent" class="form-control">
            </div>
            <div class="form-group">
                <textarea name="Content" id="txtContent" class="form-control" cols="30" rows="10"></textarea>
            </div>
            <div class="form-group">
                <label for="txtSource">Nguồn</label>
                <input type="text" id="txtSource" name="source" class="form-control">
            </div>
            <div class="form-group">
                <label for="txtLinkSource">Link nguồn</label>
                <input type="text" id="txtLinkSource" name="linksource" class="form-control">
            </div>

            <!-- Checkbox Premium -->
            <div class="form-group">
                <label for="Premium">Bài viết Premium</label>
                <input type="hidden" name="Premium" value="0">
                <div class="form-check">
                    <input type="checkbox" id="Premium" name="Premium" class="form-check-input" value="1">
                    <label class="form-check-label" for="Premium">Đánh dấu bài viết này là Premium</label>
                </div>
            </div>

            <div class="form-group">
                <button type="submit" class="btn btn-success btn-lg btn-block">Đăng</button>
            </div>
        </form>
    </div>
</div>
<script>
    // Truyền trực tiếp dữ liệu từ backend vào biến JavaScript
    const categories = {{{category}}}; // Dữ liệu JSON được truyền từ backend
    
    function loadSubcategories(categoryId) {
        const subcategorySelect = document.getElementById('txtSCID');
        // Xóa hết các options cũ trong dropdown chuyên mục con
        subcategorySelect.innerHTML = '<option value="">Chọn chuyên mục con</option>';
        
        // Lấy các chuyên mục con tương ứng với chuyên mục lớn đã chọn
        const selectedCategory = categories.find(category => category.CID == categoryId);
        
        if (selectedCategory) {
            selectedCategory.Subcategory.forEach(subcategory => {
                const option = document.createElement('option');
                option.value = subcategory.SCID;
                option.textContent = subcategory.SCName;
                subcategorySelect.appendChild(option);
            });
        }
    }
</script>
